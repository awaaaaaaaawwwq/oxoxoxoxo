<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css"> @import url(https://themes.googleusercontent.com/fonts/css?kit=kbffV7V9BIH3Ot2AQ2LQRA);</style></head><body class="doc-content" style="background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt"><p style="padding:0;margin:0;color:#000000;font-size:11pt;font-family:&quot;Arial&quot;;line-height:1.0;text-align:left"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:&quot;Courier&quot;;font-style:normal">&lt;!DOCTYPE html&gt;<br>&lt;html lang=&quot;en&quot;&gt;<br>&lt;head&gt;<br> &nbsp; &nbsp;&lt;meta charset=&quot;UTF-8&quot;&gt;<br> &nbsp; &nbsp;&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;<br> &nbsp; &nbsp;&lt;title&gt;Online Tic Tac Toe&lt;/title&gt;<br> &nbsp; &nbsp;&lt;!-- Tailwind CSS CDN for styling --&gt;<br> &nbsp; &nbsp;&lt;script src=&quot;https://cdn.tailwindcss.com&quot;&gt;&lt;/script&gt;<br> &nbsp; &nbsp;&lt;!-- Inter font for better typography --&gt;<br> &nbsp; &nbsp;&lt;link href=&quot;https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&amp;display=swap&quot; rel=&quot;stylesheet&quot;&gt;<br> &nbsp; &nbsp;&lt;style&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;body {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-family: &#39;Inter&#39;, sans-serif;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;background-color: #f0f4f8; /* Light blue-gray background */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;display: flex;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;justify-content: center;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;align-items: center;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;min-height: 100vh;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;margin: 0;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;padding: 20px;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;box-sizing: border-box;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;.container {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;background-color: #ffffff;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;border-radius: 16px; /* More rounded corners */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;padding: 32px;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;max-width: 900px; /* Wider container */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;width: 100%;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;display: grid;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;grid-template-columns: 1fr 1fr; /* Two columns for layout */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gap: 40px;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;.game-area {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;display: flex;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;flex-direction: column;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;align-items: center;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;justify-content: center;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;.game-board {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;display: grid;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;grid-template-columns: repeat(3, 100px); /* Fixed cell size */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;grid-template-rows: repeat(3, 100px);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gap: 8px; /* Slightly larger gap */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;background-color: #e2e8f0; /* Light gray background for board */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;border-radius: 12px;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;overflow: hidden; /* Ensure rounded corners for cells inside */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;margin-top: 10px; /* Space for X&#39;s timer */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;margin-bottom: 10px; /* Space for O&#39;s timer */<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;.cell {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;width: 100px;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;height: 100px;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;background-color: #f8fafc; /* Lighter cell background */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;display: flex;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;justify-content: center;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;align-items: center;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-size: 4rem; /* Larger X/O */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-weight: bold;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cursor: pointer;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;border-radius: 8px; /* Rounded corners for cells */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;transition: background-color 0.2s ease, transform 0.1s ease;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;user-select: none;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;color: #334155; /* Darker text for X/O */<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;.cell:hover:not(.x):not(.o) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;background-color: #eef2f6; /* Hover effect */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;transform: scale(1.02);<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;.cell.x {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;color: #ef4444; /* Red for X */<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;.cell.o {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;color: #3b82f6; /* Blue for O */<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;/* Pre-move highlight */<br> &nbsp; &nbsp; &nbsp; &nbsp;.cell.pre-move {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;background-color: #dbeafe; /* Light blue */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;border: 2px dashed #60a5fa; /* Dashed blue border */<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;.status-message {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-size: 1.5rem;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-weight: 600;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;margin-bottom: 16px;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;color: #1e293b;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;text-align: center;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;/* Styles for individual player timers */<br> &nbsp; &nbsp; &nbsp; &nbsp;.player-timer-display {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-size: 2rem; /* Size between status and old timer */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-weight: 700;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;color: #10b981; /* Green color for timer */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;border: 2px solid #10b981;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;padding: 8px 16px;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;border-radius: 10px;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;background-color: #ecfdf5; /* Light green background */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;margin: 10px 0;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;width: fit-content;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;text-align: center;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;min-width: 120px; /* Ensure consistent width */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-variant-numeric: tabular-nums; /* Align numbers in monospace font */<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;.player-timer-wrapper {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;display: flex;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;align-items: center;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gap: 10px;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;margin-bottom: 10px; /* Space between timer and board */<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;.player-timer-wrapper.bottom {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;margin-top: 10px; /* Space between board and timer */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;margin-bottom: 24px;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;.player-timer-label {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-size: 1.2rem;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-weight: 600;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;color: #475569;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;.player-timer-display.active {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; border-color: #3b82f6; /* Blue border for active timer */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; box-shadow: 0 0 10px rgba(59, 130, 246, 0.4);<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;.player-timer-display.low-time {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;color: #ef4444; /* Red for low time */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;border-color: #ef4444;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br><br> &nbsp; &nbsp; &nbsp; &nbsp;.scoreboard-card {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;background-color: #f8fafc;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;border-radius: 12px;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;padding: 24px;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;margin-top: 20px;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;.scoreboard-card h3 {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-size: 1.75rem; /* Larger scoreboard title */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-weight: 700;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;color: #1e293b;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;margin-bottom: 16px;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;text-align: center;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;.scoreboard-item {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;display: flex;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;justify-content: space-between;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;align-items: center;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-size: 1.25rem; /* Larger scoreboard text */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;margin-bottom: 12px;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;padding: 8px 0;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;border-bottom: 1px dashed #cbd5e1; /* Dashed separator */<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;.scoreboard-item:last-child {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;border-bottom: none;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;.scoreboard-item span:first-child {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-weight: 600;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;color: #475569;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;.scoreboard-item span:last-child {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-weight: 700;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;color: #0f172a;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;.button {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;background-color: #3b82f6; /* Blue button */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;color: white;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;padding: 12px 24px;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;border-radius: 10px;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-size: 1.1rem;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-weight: 600;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cursor: pointer;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;border: none;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;margin-top: 10px; /* Space between buttons */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;margin-right: 10px;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;.button:hover {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;background-color: #2563eb; /* Darker blue on hover */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;transform: translateY(-2px);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4);<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;.button:active {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;transform: translateY(0);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;box-shadow: 0 2px 8px rgba(59, 130, 246, 0.2);<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;.button.secondary {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;background-color: #64748b; /* Gray button */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;box-shadow: 0 4px 12px rgba(100, 116, 139, 0.3);<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;.button.secondary:hover {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;background-color: #475569;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;box-shadow: 0 6px 16px rgba(100, 116, 139, 0.4);<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;.input-field {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;padding: 12px 16px;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;border: 2px solid #cbd5e1;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;border-radius: 8px;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-size: 1rem;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;width: 100%;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;max-width: 250px;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;margin-right: 10px;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;box-sizing: border-box;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;transition: border-color 0.2s ease, box-shadow 0.2s ease;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;.input-field:focus {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;outline: none;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;border-color: #3b82f6;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;.modal {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;position: fixed;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;top: 0;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;left: 0;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;width: 100%;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;height: 100%;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;background-color: rgba(0, 0, 0, 0.6);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;display: flex;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;justify-content: center;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;align-items: center;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;z-index: 1000;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;opacity: 0;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;visibility: hidden;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;transition: opacity 0.3s ease, visibility 0.3s ease;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;.modal.show {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;opacity: 1;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;visibility: visible;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;.modal-content {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;background-color: #ffffff;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;padding: 30px;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;border-radius: 12px;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;text-align: center;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;max-width: 400px;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;width: 90%;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;transform: translateY(-20px);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;transition: transform 0.3s ease;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;.modal.show .modal-content {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;transform: translateY(0);<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;.modal-content h3 {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-size: 1.8rem;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;color: #1e293b;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;margin-bottom: 20px;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;.modal-content p {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-size: 1.1rem;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;color: #475569;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;margin-bottom: 25px;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;.modal-content button {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;background-color: #3b82f6;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;color: white;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;padding: 10px 20px;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;border-radius: 8px;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-size: 1rem;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-weight: 600;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cursor: pointer;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;border: none;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;transition: background-color 0.2s ease;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;.modal-content button:hover {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;background-color: #2563eb;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;/* Responsive adjustments */<br> &nbsp; &nbsp; &nbsp; &nbsp;@media (max-width: 768px) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.container {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;grid-template-columns: 1fr;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gap: 30px;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;padding: 24px;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.game-board {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;grid-template-columns: repeat(3, 80px); /* Smaller cells on mobile */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;grid-template-rows: repeat(3, 80px);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gap: 6px;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.cell {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;width: 80px;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;height: 80px;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-size: 3rem;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.status-message {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-size: 1.2rem;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.player-timer-display {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-size: 1.5rem;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;padding: 6px 12px;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;min-width: 100px;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.player-timer-label {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-size: 1rem;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.scoreboard-card h3 {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-size: 1.5rem;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.scoreboard-item {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-size: 1.1rem;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp;&lt;/style&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br> &nbsp; &nbsp;&lt;div class=&quot;container&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;game-area&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;h1 class=&quot;text-4xl font-bold text-gray-800 mb-6 text-center&quot;&gt;Online Tic Tac Toe&lt;/h1&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;p id=&quot;player-id-display&quot; class=&quot;text-sm text-gray-600 mb-4&quot;&gt;&lt;/p&gt;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;!-- Online Controls (Game ID, Timer Input, Create/Join) --&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;flex items-center justify-center mb-6&quot; id=&quot;onlineControls&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;text&quot; id=&quot;gameIdInput&quot; placeholder=&quot;Enter Game ID&quot; class=&quot;input-field mr-2&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;number&quot; id=&quot;gameTimerInput&quot; placeholder=&quot;Time (seconds)&quot; class=&quot;input-field w-32 mr-2&quot; min=&quot;1&quot; value=&quot;10&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button id=&quot;createGameBtn&quot; class=&quot;button&quot;&gt;Create Game&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button id=&quot;joinGameBtn&quot; class=&quot;button secondary&quot;&gt;Join Game&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;!-- Mode Switcher Buttons --&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;flex justify-center mb-6&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button id=&quot;playOfflineBtn&quot; class=&quot;button secondary mr-2&quot;&gt;Play Offline&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button id=&quot;goOnlineBtn&quot; class=&quot;button&quot; style=&quot;display: none;&quot;&gt;Go Online&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br><br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;p id=&quot;gameMessage&quot; class=&quot;status-message text-gray-700&quot;&gt;&lt;/p&gt;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;!-- Player X Timer Display --&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;player-timer-wrapper&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span class=&quot;player-timer-label text-red-500&quot;&gt;X&#39;s Time:&lt;/span&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;playerXTimerDisplay&quot; class=&quot;player-timer-display&quot;&gt;00:00&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;gameBoard&quot; class=&quot;game-board&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;!-- Cells will be dynamically generated here by JavaScript --&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;!-- Player O Timer Display --&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;player-timer-wrapper bottom&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span class=&quot;player-timer-label text-blue-500&quot;&gt;O&#39;s Time:&lt;/span&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;playerOTimerDisplay&quot; class=&quot;player-timer-display&quot;&gt;00:00&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br><br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;!-- Game Control Buttons --&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;flex justify-center mt-4 space-x-4&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button id=&quot;readyBtn&quot; class=&quot;button text-lg px-8 py-3&quot; style=&quot;display: none;&quot;&gt;Ready!&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button id=&quot;rematchBtn&quot; class=&quot;button secondary text-lg px-8 py-3&quot; style=&quot;display: none;&quot;&gt;Rematch&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button id=&quot;newGameBtn&quot; class=&quot;button&quot; style=&quot;display: none;&quot;&gt;Play Again&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br><br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;scoreboard-area&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;scoreboard-card&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;h3&gt;Scoreboard&lt;/h3&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;scoreboard-item&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&gt;X Wins&lt;/span&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span id=&quot;playerXWins&quot;&gt;0&lt;/span&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;scoreboard-item&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&gt;O Wins&lt;/span&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span id=&quot;playerOWins&quot;&gt;0&lt;/span&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;scoreboard-item&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&gt;Draws&lt;/span&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span id=&quot;draws&quot;&gt;0&lt;/span&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button id=&quot;resetScoreboardBtn&quot; class=&quot;button secondary w-full mt-4&quot;&gt;Reset Scoreboard&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;scoreboard-card mt-6&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;h3&gt;Game Rooms (Join or Create)&lt;/h3&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;ul id=&quot;gameList&quot; class=&quot;text-gray-700 max-h-40 overflow-y-auto&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;!-- Game rooms will be listed here --&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/ul&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp;&lt;/div&gt;<br><br> &nbsp; &nbsp;&lt;!-- Custom Modal for messages --&gt;<br> &nbsp; &nbsp;&lt;div id=&quot;customModal&quot; class=&quot;modal&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;modal-content&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;h3 id=&quot;modalTitle&quot;&gt;&lt;/h3&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;p id=&quot;modalMessage&quot;&gt;&lt;/p&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;flex justify-center mt-4 space-x-4&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button id=&quot;modalConfirmBtn&quot; class=&quot;button&quot; style=&quot;display: none;&quot;&gt;Confirm&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button id=&quot;modalCloseBtn&quot; class=&quot;button&quot;&gt;OK&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp;&lt;/div&gt;<br><br> &nbsp; &nbsp;&lt;!-- Firebase CDN --&gt;<br> &nbsp; &nbsp;&lt;script type=&quot;module&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;import { initializeApp } from &quot;https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp;import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from &quot;https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp;import { getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot, collection, query, where, addDoc, getDocs, deleteDoc } from &quot;https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js&quot;;<br><br> &nbsp; &nbsp; &nbsp; &nbsp;// --- IMPORTANT: YOUR FIREBASE CONFIGURATION ---<br> &nbsp; &nbsp; &nbsp; &nbsp;const MY_FIREBASE_CONFIG = {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;apiKey: &quot;AIzaSyA9Vl4jaZy8rSqOBUOMzjYXk0-gsnTyndA&quot;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;authDomain: &quot;tic-tac-toe-c03bc.firebaseapp.com&quot;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;projectId: &quot;tic-tac-toe-c03bc&quot;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;storageBucket: &quot;tic-tac-toe-c03bc.firebasestorage.app&quot;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;messagingSenderId: &quot;64653382789&quot;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;appId: &quot;1:64653382789:web:6ba35c22b605e0136705ec&quot;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;measurementId: &quot;G-FQ1847PGSR&quot;<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br> &nbsp; &nbsp; &nbsp; &nbsp;// --- END OF FIREBASE CONFIGURATION SECTION ---<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const MY_APP_ID = &quot;my-local-tic-tac-toe-app&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp;const STALE_ROOM_TIMEOUT_MS = 1 * 60 * 1000; // 1 minute in milliseconds<br> &nbsp; &nbsp; &nbsp; &nbsp;const LOW_TIME_THRESHOLD_MS = 3 * 1000; // Time remaining for timer to turn red (3 seconds)<br><br> &nbsp; &nbsp; &nbsp; &nbsp;let app;<br> &nbsp; &nbsp; &nbsp; &nbsp;let db;<br> &nbsp; &nbsp; &nbsp; &nbsp;let auth;<br> &nbsp; &nbsp; &nbsp; &nbsp;let unsubscribeGameListener;<br><br> &nbsp; &nbsp; &nbsp; &nbsp;let board = [&quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;];<br> &nbsp; &nbsp; &nbsp; &nbsp;let currentPlayer = &quot;X&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp;let gameActive = false;<br> &nbsp; &nbsp; &nbsp; &nbsp;let winner = null;<br><br> &nbsp; &nbsp; &nbsp; &nbsp;let currentUserId = null;<br> &nbsp; &nbsp; &nbsp; &nbsp;let gameId = null;<br> &nbsp; &nbsp; &nbsp; &nbsp;let isHost = false;<br> &nbsp; &nbsp; &nbsp; &nbsp;let playerSymbol = null;<br> &nbsp; &nbsp; &nbsp; &nbsp;let opponentSymbol = null;<br><br> &nbsp; &nbsp; &nbsp; &nbsp;let isOfflineMode = false;<br><br> &nbsp; &nbsp; &nbsp; &nbsp;let playerXReady = false;<br> &nbsp; &nbsp; &nbsp; &nbsp;let playerOReady = false;<br> &nbsp; &nbsp; &nbsp; &nbsp;let playerXRematch = false;<br> &nbsp; &nbsp; &nbsp; &nbsp;let playerORematch = false;<br><br> &nbsp; &nbsp; &nbsp; &nbsp;let localPlayerXTimeLeft = 0;<br> &nbsp; &nbsp; &nbsp; &nbsp;let localPlayerOTimeLeft = 0;<br> &nbsp; &nbsp; &nbsp; &nbsp;let localTurnStartTime = Date.now();<br> &nbsp; &nbsp; &nbsp; &nbsp;let timerInterval;<br><br> &nbsp; &nbsp; &nbsp; &nbsp;let playerXScore = 0;<br> &nbsp; &nbsp; &nbsp; &nbsp;let playerOScore = 0;<br> &nbsp; &nbsp; &nbsp; &nbsp;let drawScore = 0;<br><br> &nbsp; &nbsp; &nbsp; &nbsp;let preMoveIndexToHighlight = -1;<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const gameTimerInput = document.getElementById(&quot;gameTimerInput&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp;const gameBoard = document.getElementById(&quot;gameBoard&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp;const gameMessage = document.getElementById(&quot;gameMessage&quot;);<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const playerXTimerDisplay = document.getElementById(&quot;playerXTimerDisplay&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp;const playerOTimerDisplay = document.getElementById(&quot;playerOTimerDisplay&quot;);<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const newGameBtn = document.getElementById(&quot;newGameBtn&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp;const createGameBtn = document.getElementById(&quot;createGameBtn&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp;const joinGameBtn = document.getElementById(&quot;joinGameBtn&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp;const gameIdInput = document.getElementById(&quot;gameIdInput&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp;const playerIdDisplay = document.getElementById(&quot;player-id-display&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp;const playerXWins = document.getElementById(&quot;playerXWins&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp;const playerOWins = document.getElementById(&quot;playerOWins&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp;const draws = document.getElementById(&quot;draws&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp;const gameList = document.getElementById(&quot;gameList&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp;const readyBtn = document.getElementById(&quot;readyBtn&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp;const rematchBtn = document.getElementById(&quot;rematchBtn&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp;const resetScoreboardBtn = document.getElementById(&quot;resetScoreboardBtn&quot;);<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const playOfflineBtn = document.getElementById(&quot;playOfflineBtn&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp;const goOnlineBtn = document.getElementById(&quot;goOnlineBtn&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp;const onlineControlsDiv = document.getElementById(&quot;onlineControls&quot;);<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const customModal = document.getElementById(&quot;customModal&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp;const modalTitle = document.getElementById(&quot;modalTitle&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp;const modalMessage = document.getElementById(&quot;modalMessage&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp;const modalCloseBtn = document.getElementById(&quot;modalCloseBtn&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp;const modalConfirmBtn = document.getElementById(&quot;modalConfirmBtn&quot;);<br><br> &nbsp; &nbsp; &nbsp; &nbsp;let modalConfirmCallback = null;<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const initFirebase = async () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;try {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const firebaseConfig = MY_FIREBASE_CONFIG;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.log(&quot;Attempting to initialize Firebase with config:&quot;, firebaseConfig);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;app = initializeApp(firebaseConfig);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;db = getFirestore(app);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;auth = getAuth(app);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await signInAnonymously(auth);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;onAuthStateChanged(auth, (user) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (user) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentUserId = user.uid;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerIdDisplay.textContent = `Your User ID: ${currentUserId}`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.log(&quot;Firebase initialized and user signed in:&quot;, currentUserId);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;loadScoreboard(currentUserId);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;renderBoard();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;listenToLobbyChanges();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayMessage(&quot;Welcome! Create or join an online game, or Play Offline.&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showOnlineControls();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.log(&quot;No user signed in.&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentUserId = null;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerIdDisplay.textContent = &quot;Not signed in.&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showOfflineControls(false);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayMessage(&quot;Please sign in or play offline.&quot;, &quot;text-gray-700&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} catch (error) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.error(&quot;Error initializing Firebase:&quot;, error);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let errorMessage = &quot;Failed to initialize game. Please check your internet connection and try again.&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (error.code === &#39;auth/configuration-not-found&#39;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;errorMessage = `Firebase Error: ${error.message}. This usually means that the **Anonymous Authentication provider is not enabled** in your Firebase project. To fix this, go to your Firebase Console: 1. Navigate to **Authentication** (left menu). 2. Click on the **Sign-in method** tab. 3. Find and **enable &#39;Anonymous&#39;** as a sign-in provider. 4. Also, ensure your **Firestore Security Rules** are correctly set to allow anonymous users to read/write data for this app.`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayModal(&quot;Initialization Error&quot;, errorMessage, false);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showOfflineControls(false);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const renderBoard = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gameBoard.innerHTML = &quot;&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;board.forEach((cell, index) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const cellElement = document.createElement(&quot;div&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cellElement.classList.add(&quot;cell&quot;, &quot;rounded-lg&quot;, &quot;shadow-md&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cellElement.setAttribute(&quot;data-index&quot;, index);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cellElement.textContent = cell;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (cell === &quot;X&quot;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cellElement.classList.add(&quot;x&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else if (cell === &quot;O&quot;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cellElement.classList.add(&quot;o&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!isOfflineMode &amp;&amp; index === preMoveIndexToHighlight) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cellElement.classList.add(&quot;pre-move&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cellElement.classList.remove(&quot;pre-move&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (gameActive &amp;&amp; board[index] === &quot;&quot;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cellElement.addEventListener(&quot;click&quot;, () =&gt; handleClick(index));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cellElement.style.cursor = &quot;default&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gameBoard.appendChild(cellElement);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const formatTime = (ms) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const totalSeconds = Math.max(0, Math.floor(ms / 1000));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const milliseconds = Math.max(0, ms % 1000);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return `${totalSeconds.toString().padStart(2, &#39;0&#39;)}:${Math.floor(milliseconds / 10).toString().padStart(2, &#39;0&#39;)}`; // Show two digits for milliseconds (tens of ms)<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const updateTimerDisplay = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let xTimeRemaining = localPlayerXTimeLeft;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let oTimeRemaining = localPlayerOTimeLeft;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (gameActive) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const timeElapsedOnActiveTurn = Date.now() - localTurnStartTime;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (currentPlayer === &quot;X&quot;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;xTimeRemaining = Math.max(0, localPlayerXTimeLeft - timeElapsedOnActiveTurn);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;oTimeRemaining = Math.max(0, localPlayerOTimeLeft - timeElapsedOnActiveTurn);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerXTimerDisplay.textContent = formatTime(xTimeRemaining);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerXTimerDisplay.classList.remove(&#39;active&#39;, &#39;low-time&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (gameActive &amp;&amp; currentPlayer === &quot;X&quot;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerXTimerDisplay.classList.add(&#39;active&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (xTimeRemaining &lt;= LOW_TIME_THRESHOLD_MS &amp;&amp; xTimeRemaining &gt; 0) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerXTimerDisplay.classList.add(&#39;low-time&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else if (xTimeRemaining &lt;= 0) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerXTimerDisplay.classList.add(&#39;low-time&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; playerXTimerDisplay.style.color = &#39;#10b981&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; playerXTimerDisplay.style.borderColor = &#39;#10b981&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerOTimerDisplay.textContent = formatTime(oTimeRemaining);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerOTimerDisplay.classList.remove(&#39;active&#39;, &#39;low-time&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (gameActive &amp;&amp; currentPlayer === &quot;O&quot;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerOTimerDisplay.classList.add(&#39;active&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (oTimeRemaining &lt;= LOW_TIME_THRESHOLD_MS &amp;&amp; oTimeRemaining &gt; 0) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerOTimerDisplay.classList.add(&#39;low-time&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else if (oTimeRemaining &lt;= 0) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerOTimerDisplay.classList.add(&#39;low-time&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; playerOTimerDisplay.style.color = &#39;#10b981&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; playerOTimerDisplay.style.borderColor = &#39;#10b981&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const displayMessage = (msg, color = &#39;text-gray-700&#39;) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gameMessage.textContent = msg;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gameMessage.className = `status-message ${color}`;<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const updateScoreboardUI = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerXWins.textContent = playerXScore;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerOWins.textContent = playerOScore;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;draws.textContent = drawScore;<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const displayModal = (title, message, showConfirm = false, onConfirm = null) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;modalTitle.textContent = title;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;modalMessage.innerHTML = message;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;modalConfirmBtn.style.display = showConfirm ? &#39;block&#39; : &#39;none&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;modalCloseBtn.style.display = &#39;block&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;modalConfirmCallback = onConfirm;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;customModal.classList.add(&quot;show&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const hideModal = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;customModal.classList.remove(&quot;show&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;modalConfirmCallback = null;<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const performMove = async (index, symbol) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let currentBoardState = [...board];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let currentXTimeLeft = localPlayerXTimeLeft;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let currentOTimeLeft = localPlayerOTimeLeft;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let currentTurnStart = localTurnStartTime;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let currentMoves = 0;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let totalGameTimeMs = parseInt(gameTimerInput.value) * 1000 || 10 * 1000;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!isOfflineMode) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const gameRef = doc(db, `artifacts/${MY_APP_ID}/public/data/games`, gameId);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const freshGameDoc = await getDoc(gameRef);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const gameDataFromFirebase = freshGameDoc.data();<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!gameDataFromFirebase || gameDataFromFirebase.board[index] !== &quot;&quot; || gameDataFromFirebase.currentPlayer !== symbol) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.warn(&quot;Move thwarted by race condition or invalid state (online).&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentBoardState = [...gameDataFromFirebase.board];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentXTimeLeft = gameDataFromFirebase.playerXTimeLeft;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentOTimeLeft = gameDataFromFirebase.playerOTimeLeft;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentTurnStart = gameDataFromFirebase.turnStartTime;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentMoves = gameDataFromFirebase.moves;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;totalGameTimeMs = gameDataFromFirebase.totalGameTime;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (currentBoardState[index] !== &quot;&quot;) { // For offline, just check if cell is occupied<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.warn(&quot;Move thwarted by invalid state (offline). Cell already occupied.&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentBoardState[index] = symbol;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const nextPlayer = symbol === &quot;X&quot; ? &quot;O&quot; : &quot;X&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const currentStatus = checkGameStatus(currentBoardState, symbol);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const timeSpentOnThisTurn = Date.now() - currentTurnStart;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (symbol === &quot;X&quot;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentXTimeLeft = Math.max(0, currentXTimeLeft - timeSpentOnThisTurn);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentOTimeLeft = Math.max(0, currentOTimeLeft - timeSpentOnThisTurn);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;board = currentBoardState;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentPlayer = nextPlayer;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;localPlayerXTimeLeft = currentXTimeLeft;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;localPlayerOTimeLeft = currentOTimeLeft;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;localTurnStartTime = Date.now();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;renderBoard();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;updateTimerDisplay();<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (isOfflineMode) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (currentStatus.includes(&quot;_wins&quot;)) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;winner = symbol;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gameActive = false;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayMessage(`${winner} wins! Game over (Offline).`, winner === &quot;X&quot; ? &quot;text-red-700&quot; : &quot;text-blue-700&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (winner === &quot;X&quot;) playerXScore++; else playerOScore++;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;updateScoreboardUI();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else if (currentStatus === &quot;draw&quot;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;winner = &quot;draw&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gameActive = false;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayMessage(&quot;It&#39;s a draw! Game over (Offline).&quot;, &quot;text-blue-700&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;drawScore++;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;updateScoreboardUI();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else if (currentXTimeLeft &lt;= 0 &amp;&amp; symbol === &quot;X&quot;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;winner = &quot;O&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gameActive = false;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayMessage(`X ran out of time! O wins! (Offline)`, &quot;text-red-700&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerOScore++;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;updateScoreboardUI();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else if (currentOTimeLeft &lt;= 0 &amp;&amp; symbol === &quot;O&quot;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;winner = &quot;X&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gameActive = false;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayMessage(`O ran out of time! X wins! (Offline)`, &quot;text-red-700&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerXScore++;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;updateScoreboardUI();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayMessage(`It&#39;s ${currentPlayer}&#39;s turn (Offline).`, currentPlayer === &quot;X&quot; ? &quot;text-green-700&quot; : &quot;text-yellow-700&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!gameActive) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;newGameBtn.style.display = &#39;block&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;stopTimer();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;startTimer(localPlayerXTimeLeft, localPlayerOTimeLeft, localTurnStartTime, currentPlayer);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const gameRef = doc(db, `artifacts/${MY_APP_ID}/public/data/games`, gameId);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let updateData = {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;board: currentBoardState,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentPlayer: nextPlayer,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;turnStartTime: Date.now(),<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerXTimeLeft: currentXTimeLeft,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerOTimeLeft: currentOTimeLeft,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;moves: currentMoves + 1,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;preMove: null<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (currentStatus.includes(&quot;_wins&quot;)) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;updateData.status = currentStatus;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;updateData.winnerId = currentUserId;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else if (currentStatus === &quot;draw&quot;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;updateData.status = &quot;draw&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else if (currentXTimeLeft &lt;= 0 &amp;&amp; symbol === &quot;X&quot;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;updateData.status = &quot;X_timeout&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else if (currentOTimeLeft &lt;= 0 &amp;&amp; symbol === &quot;O&quot;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;updateData.status = &quot;O_timeout&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;try {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await updateDoc(gameRef, updateData);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} catch (error) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.error(&quot;Error updating game state:&quot;, error);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayModal(&quot;Error&quot;, &quot;Failed to make move. Please try again.&quot;, false);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const handleClick = async (index) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!gameActive || board[index] !== &quot;&quot; || winner !== null) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (isOfflineMode) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await performMove(index, currentPlayer);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!gameId || !playerSymbol || !currentUserId) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayMessage(&quot;Please join an online game first and ensure you are authenticated!&quot;, &quot;text-red-600&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const gameRef = doc(db, `artifacts/${MY_APP_ID}/public/data/games`, gameId);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let gameDoc = await getDoc(gameRef);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let gameData = gameDoc.data();<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!gameData || gameData.status !== &quot;playing&quot; || winner !== null) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayMessage(&quot;Game is not in a valid state for your move.&quot;, &quot;text-red-600&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (gameData.board[index] !== &quot;&quot;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayMessage(&quot;Cell is already occupied!&quot;, &quot;text-red-600&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (isMyTurn()) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await performMove(index, playerSymbol);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (gameData.status === &quot;playing&quot;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const preMoveUpdate = { preMove: { userId: currentUserId, index: index } };<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;try {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await updateDoc(gameRef, preMoveUpdate);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayMessage(`Pre-moved to ${index + 1}. Waiting for opponent&#39;s turn.`, &quot;text-blue-600&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} catch (error) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.error(&quot;Error setting pre-move:&quot;, error);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayModal(&quot;Error&quot;, &quot;Failed to set pre-move. Please try again.&quot;, false);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayMessage(&quot;Cannot pre-move outside of an active game.&quot;, &quot;text-red-600&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const checkGameStatus = (currentBoard, player) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const winConditions = [<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;[0, 1, 2], [3, 4, 5], [6, 7, 8],<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;[0, 3, 6], [1, 4, 7], [2, 5, 8],<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;[0, 4, 8], [2, 4, 6]<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;];<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for (let i = 0; i &lt; winConditions.length; i++) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const [a, b, c] = winConditions[i];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (currentBoard[a] === player &amp;&amp; currentBoard[b] === player &amp;&amp; currentBoard[c] === player) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return `${player}_wins`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (currentBoard.every(cell =&gt; cell !== &quot;&quot;)) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return &quot;draw&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return &quot;playing&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const isMyTurn = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return isOfflineMode || (gameActive &amp;&amp; currentPlayer === playerSymbol);<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const startTimer = (initialPlayerXTimeLeft, initialPlayerOTimeLeft, initialTurnStartTime, currentTurnPlayer) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;stopTimer();<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;localPlayerXTimeLeft = initialPlayerXTimeLeft;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;localPlayerOTimeLeft = initialPlayerOTimeLeft;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;localTurnStartTime = initialTurnStartTime;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentPlayer = currentTurnPlayer;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;updateTimerDisplay();<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;timerInterval = setInterval(async () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;updateTimerDisplay();<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let activePlayerTimeRemaining = 0;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (currentTurnPlayer === &quot;X&quot;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;activePlayerTimeRemaining = localPlayerXTimeLeft - (Date.now() - localTurnStartTime);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;activePlayerTimeRemaining = localPlayerOTimeLeft - (Date.now() - localTurnStartTime);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (activePlayerTimeRemaining &lt;= 0) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;stopTimer();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!isOfflineMode &amp;&amp; gameId &amp;&amp; gameActive &amp;&amp; currentTurnPlayer === playerSymbol) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const gameRef = doc(db, `artifacts/${MY_APP_ID}/public/data/games`, gameId);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let timeoutStatus = (currentTurnPlayer === &quot;X&quot;) ? &quot;X_timeout&quot; : &quot;O_timeout&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;try {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await updateDoc(gameRef, { status: timeoutStatus });<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} catch (error) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.error(&quot;Error setting timeout status:&quot;, error);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else if (isOfflineMode &amp;&amp; gameActive) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;winner = (currentTurnPlayer === &quot;X&quot;) ? &quot;O&quot; : &quot;X&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gameActive = false;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayMessage(`${currentTurnPlayer} ran out of time! ${winner} wins! (Offline)`, &quot;text-red-700&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (winner === &quot;X&quot;) playerXScore++; else playerOScore++;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;updateScoreboardUI();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;newGameBtn.style.display = &#39;block&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;updateTimerDisplay();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}, 100);<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const stopTimer = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;clearInterval(timerInterval);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;timerInterval = null;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;updateTimerDisplay();<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const handleReadyClick = async () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (isOfflineMode) return;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!gameId || !playerSymbol || !currentUserId) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayModal(&quot;Error&quot;, &quot;Not in a game or symbol not assigned. Please wait for authentication.&quot;, false);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const gameRef = doc(db, `artifacts/${MY_APP_ID}/public/data/games`, gameId);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let updateField = {};<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let newReadyState;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (playerSymbol === &quot;X&quot;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;newReadyState = !playerXReady;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;updateField.playerXReady = newReadyState;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;newReadyState = !playerOReady;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;updateField.playerOReady = newReadyState;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;try {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await updateDoc(gameRef, updateField);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} catch (error) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.error(&quot;Error setting player ready status:&quot;, error);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayModal(&quot;Error&quot;, &quot;Failed to set ready status. Please try again.&quot;, false);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const handleRematchClick = async () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (isOfflineMode) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;resetGame();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!gameId || !playerSymbol || !currentUserId) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayModal(&quot;Error&quot;, &quot;Not in a game or symbol not assigned. Please wait for authentication.&quot;, false);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const gameRef = doc(db, `artifacts/${MY_APP_ID}/public/data/games`, gameId);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let updateField = {};<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (playerSymbol === &quot;X&quot;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;updateField.playerXRematch = true;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;updateField.playerORematch = true;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;try {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await updateDoc(gameRef, updateField);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayMessage(`Waiting for ${opponentSymbol} to accept rematch...`, &quot;text-blue-600&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rematchBtn.style.display = &#39;none&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;newGameBtn.style.display = &#39;none&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} catch (error) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.error(&quot;Error requesting rematch:&quot;, error);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayModal(&quot;Error&quot;, &quot;Failed to request rematch. Please try again.&quot;, false);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const resetScoreboard = async () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!currentUserId) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayModal(&quot;Error&quot;, &quot;User not authenticated. Cannot reset scoreboard.&quot;, false);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayModal(<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;Confirm Reset&quot;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;Are you sure you want to reset your scoreboard? This action cannot be undone.&quot;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;true,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;async () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const scoreboardRef = getScoreboardRef(currentUserId);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;try {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await setDoc(scoreboardRef, { xWins: 0, oWins: 0, draws: 0 });<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerXScore = 0;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerOScore = 0;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;drawScore = 0;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;updateScoreboardUI();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayModal(&quot;Success&quot;, &quot;Scoreboard has been reset!&quot;, false);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} catch (error) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.error(&quot;Error resetting scoreboard:&quot;, error);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayModal(&quot;Error&quot;, &quot;Failed to reset scoreboard. Please try again.&quot;, false);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;);<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br><br> &nbsp; &nbsp; &nbsp; &nbsp;const createGame = async () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!currentUserId) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayModal(&quot;Login Required&quot;, &quot;Please wait for user authentication.&quot;, false);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const newGameId = gameIdInput.value.trim() || crypto.randomUUID().substring(0, 8);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const customTimerSeconds = parseInt(gameTimerInput.value);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let gameTotalTimeMs;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (isNaN(customTimerSeconds) || customTimerSeconds &lt;= 0) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayModal(&quot;Invalid Timer Input&quot;, &quot;Please enter a positive number for the game timer (in seconds). Defaulting to 10 seconds.&quot;, false);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gameTotalTimeMs = 10 * 1000;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gameTotalTimeMs = customTimerSeconds * 1000;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const gameRef = doc(db, `artifacts/${MY_APP_ID}/public/data/games`, newGameId);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;try {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const gameDoc = await getDoc(gameRef);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (gameDoc.exists()) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayModal(&quot;Game Exists&quot;, `Game ID &#39;${newGameId}&#39; already exists. Please choose a different ID or join it.`, false);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await setDoc(gameRef, {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;board: [&quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;],<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentPlayer: &quot;X&quot;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerXId: currentUserId,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerOId: null,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;status: &quot;waiting&quot;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerXReady: false,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerOReady: false,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerXRematch: false,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerORematch: false,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lastMoveTime: Date.now(),<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;createdAt: Date.now(),<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;moves: 0,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerXTimeLeft: gameTotalTimeMs,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerOTimeLeft: gameTotalTimeMs,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;turnStartTime: Date.now(),<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;totalGameTime: gameTotalTimeMs,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;preMove: null<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gameId = newGameId;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;isHost = true;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerSymbol = &quot;X&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;opponentSymbol = &quot;O&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayMessage(`Game &#39;${gameId}&#39; created! Share this ID with a friend. Waiting for opponent...`, &quot;text-green-600&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;listenToGameChanges(gameId);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;newGameBtn.style.display = &#39;none&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;readyBtn.style.display = &#39;none&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rematchBtn.style.display = &#39;none&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gameActive = false;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;localPlayerXTimeLeft = gameTotalTimeMs;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;localPlayerOTimeLeft = gameTotalTimeMs;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;updateTimerDisplay();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} catch (error) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.error(&quot;Error creating game:&quot;, error);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayModal(&quot;Error&quot;, &quot;Failed to create game. Please ensure your Firebase setup is complete and rules allow writing.&quot;, false);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const joinGame = async () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!currentUserId) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayModal(&quot;Login Required&quot;, &quot;Please wait for user authentication.&quot;, false);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const idToJoin = gameIdInput.value.trim();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!idToJoin) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayModal(&quot;Invalid ID&quot;, &quot;Please enter a Game ID to join.&quot;, false);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const gameRef = doc(db, `artifacts/${MY_APP_ID}/public/data/games`, idToJoin);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;try {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const gameDoc = await getDoc(gameRef);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!gameDoc.exists()) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayModal(&quot;Game Not Found&quot;, `No game found with ID &#39;${idToJoin}&#39;.`, false);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const gameData = gameDoc.data();<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (gameData.playerXId &amp;&amp; gameData.playerOId) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayModal(&quot;Game Full&quot;, &quot;This game is already full. Please find another game or create a new one.&quot;, false);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (gameData.playerXId === currentUserId || gameData.playerOId === currentUserId) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayModal(&quot;Already in Game&quot;, &quot;You are already a part of this game. Rejoining...&quot;, false);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gameId = idToJoin;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (gameData.playerXId === currentUserId) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerSymbol = &quot;X&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;opponentSymbol = &quot;O&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else if (gameData.playerOId === currentUserId) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerSymbol = &quot;O&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;opponentSymbol = &quot;X&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;isHost = (gameData.playerXId === currentUserId);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;listenToGameChanges(gameId);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await updateDoc(gameRef, {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerOId: currentUserId,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;status: &quot;ready_check&quot;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerOReady: false,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerORematch: false<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gameId = idToJoin;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;isHost = false;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerSymbol = &quot;O&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;opponentSymbol = &quot;X&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayMessage(`Joined game &#39;${gameId}&#39; as O! Press Ready to start!`, &quot;text-green-600&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;listenToGameChanges(gameId);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;newGameBtn.style.display = &#39;none&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;readyBtn.style.display = &#39;block&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rematchBtn.style.display = &#39;none&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gameActive = false;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;stopTimer();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} catch (error) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.error(&quot;Error joining game:&quot;, error);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayModal(&quot;Error&quot;, &quot;Failed to join game. Please ensure your Firebase setup is complete and rules allow writing.&quot;, false);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const listenToGameChanges = (id) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (unsubscribeGameListener) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;unsubscribeGameListener();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (isOfflineMode) return;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const gameRef = doc(db, `artifacts/${MY_APP_ID}/public/data/games`, id);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;unsubscribeGameListener = onSnapshot(gameRef, async (docSnap) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (docSnap.exists()) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const data = docSnap.data();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;board = data.board;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentPlayer = data.currentPlayer;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;winner = null;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gameId = id;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerXReady = data.playerXReady || false;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerOReady = data.playerOReady || false;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerXRematch = data.playerXRematch || false;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerORematch = data.playerORematch || false;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;localPlayerXTimeLeft = data.playerXTimeLeft;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;localPlayerOTimeLeft = data.playerOTimeLeft;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;localTurnStartTime = data.turnStartTime;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (currentUserId) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (data.playerXId === currentUserId) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerSymbol = &quot;X&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;opponentSymbol = &quot;O&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;isHost = true;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else if (data.playerOId === currentUserId) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerSymbol = &quot;O&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;opponentSymbol = &quot;X&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;isHost = false;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerSymbol = null;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;opponentSymbol = null;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (playerSymbol) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerIdDisplay.textContent = `Your User ID: ${currentUserId} (You are ${playerSymbol})`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerIdDisplay.textContent = `Your User ID: ${currentUserId} (Not in game)`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerIdDisplay.textContent = &quot;Not signed in.&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerSymbol = null;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;opponentSymbol = null;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;preMoveIndexToHighlight = -1;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (data.preMove &amp;&amp; data.preMove.userId === currentUserId &amp;&amp; data.status === &quot;playing&quot; &amp;&amp; data.board[data.preMove.index] === &quot;&quot;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;preMoveIndexToHighlight = data.preMove.index;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;renderBoard();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;newGameBtn.style.display = &#39;none&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rematchBtn.style.display = &#39;none&#39;;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (data.status === &quot;waiting&quot;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gameActive = false;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;stopTimer();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;readyBtn.style.display = &#39;none&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayMessage(`Game &#39;${gameId}&#39;: Waiting for opponent... (Host: ${data.playerXId.substring(0,6)}...)`, &quot;text-blue-600&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;localPlayerXTimeLeft = data.totalGameTime;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;localPlayerOTimeLeft = data.totalGameTime;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;updateTimerDisplay();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else if (data.status === &quot;ready_check&quot;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gameActive = false;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;stopTimer();<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (playerXReady &amp;&amp; playerOReady) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayMessage(&quot;Both players ready! Starting game...&quot;, &quot;text-green-600&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;readyBtn.style.display = &#39;none&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;setTimeout(async () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;try {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await updateDoc(gameRef, {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;status: &quot;playing&quot;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;turnStartTime: Date.now(),<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerXTimeLeft: data.totalGameTime,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerOTimeLeft: data.totalGameTime,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;preMove: null<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} catch (error) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.error(&quot;Error transitioning to playing status:&quot;, error);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}, 1000);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const myCurrentReadyState = (playerSymbol === &quot;X&quot; &amp;&amp; playerXReady) || (playerSymbol === &quot;O&quot; &amp;&amp; playerOReady);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (myCurrentReadyState) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;readyBtn.style.display = &#39;block&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;readyBtn.textContent = &#39;Unready&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayMessage(`You are Ready! Waiting for opponent.`, &quot;text-blue-600&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;readyBtn.style.display = &#39;block&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;readyBtn.textContent = &#39;Ready!&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const oppReadyText = (playerSymbol === &quot;X&quot; ? playerOReady : playerXReady) ? &#39;IS&#39; : &#39;is NOT&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayMessage(`Game &#39;${gameId}&#39;: Press Ready. Opponent (${opponentSymbol}) ${oppReadyText} ready.`, &quot;text-blue-600&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;updateTimerDisplay();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else if (data.status === &quot;playing&quot;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gameActive = true;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;readyBtn.style.display = &#39;none&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;startTimer(data.playerXTimeLeft, data.playerOTimeLeft, data.turnStartTime, data.currentPlayer);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (data.preMove &amp;&amp; data.preMove.userId === currentUserId &amp;&amp; data.currentPlayer === playerSymbol) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (data.board[data.preMove.index] === &quot;&quot;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.log(&quot;Auto-activating pre-move:&quot;, data.preMove.index);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayMessage(`Auto-moving to ${data.preMove.index + 1} (pre-move).`, &quot;text-purple-600&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await performMove(data.preMove.index, playerSymbol);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (isMyTurn()) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayMessage(`It&#39;s your turn (${playerSymbol})!`, &quot;text-green-700&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayMessage(`Opponent&#39;s turn (${opponentSymbol})`, &quot;text-yellow-700&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else if (data.status.includes(&quot;_wins&quot;) || data.status === &quot;draw&quot; || data.status.includes(&quot;_timeout&quot;)) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gameActive = false;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;stopTimer();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;readyBtn.style.display = &#39;none&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;preMoveIndexToHighlight = -1;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;renderBoard();<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (data.status.includes(&quot;_wins&quot;)) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;winner = data.status.split(&quot;_&quot;)[0];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayMessage(`${winner} wins! Game over.`, winner === playerSymbol ? &quot;text-green-700&quot; : &quot;text-red-700&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (winner === &quot;X&quot;) updateScoreboard(currentUserId, 1, 0, 0);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;else if (winner === &quot;O&quot;) updateScoreboard(currentUserId, 0, 1, 0);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else if (data.status.includes(&quot;_timeout&quot;)) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const timedOutPlayer = data.status.split(&quot;_&quot;)[0];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const winnerByTimeout = (timedOutPlayer === &quot;X&quot;) ? &quot;O&quot; : &quot;X&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayMessage(`${timedOutPlayer} ran out of time! ${winnerByTimeout} wins!`, winnerByTimeout === playerSymbol ? &quot;text-green-700&quot; : &quot;text-red-700&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (winnerByTimeout === &quot;X&quot;) updateScoreboard(currentUserId, 1, 0, 0);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;else if (winnerByTimeout === &quot;O&quot;) updateScoreboard(currentUserId, 0, 1, 0);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else if (data.status === &quot;draw&quot;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayMessage(&quot;It&#39;s a draw! Game over.&quot;, &quot;text-blue-700&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;updateScoreboard(currentUserId, 0, 0, 1);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (playerSymbol) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rematchBtn.style.display = &#39;block&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;newGameBtn.style.display = &#39;block&#39;;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (playerXRematch &amp;&amp; playerORematch) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayMessage(&quot;Both players requested rematch! Resetting game...&quot;, &quot;text-green-600&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rematchBtn.style.display = &#39;none&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; newGameBtn.style.display = &#39;none&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;setTimeout(async () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;try {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await updateDoc(gameRef, {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;board: [&quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;],<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentPlayer: &quot;X&quot;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;status: &quot;ready_check&quot;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerXReady: false,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerOReady: false,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerXRematch: false,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerORematch: false,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerXTimeLeft: data.totalGameTime,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerOTimeLeft: data.totalGameTime,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;turnStartTime: Date.now(),<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;moves: 0,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;preMove: null<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} catch (error) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.error(&quot;Error resetting game for rematch:&quot;, error);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}, 1000);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayModal(&quot;Game Ended&quot;, &quot;The game you were in has ended or was deleted by the host.&quot;, false);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;resetGame();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showOnlineControls();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayMessage(&quot;Welcome! Create or join an online game, or Play Offline.&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}, (error) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.error(&quot;Error listening to game changes:&quot;, error);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayModal(&quot;Error&quot;, &quot;Lost connection to game. Please check your internet or try joining again.&quot;, false);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;resetGame();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showOnlineControls();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayMessage(&quot;Welcome! Create or join an online game, or Play Offline.&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const resetGame = async () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;board = [&quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentPlayer = &quot;X&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;winner = null;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;localPlayerXTimeLeft = parseInt(gameTimerInput.value) * 1000 || 10 * 1000;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;localPlayerOTimeLeft = parseInt(gameTimerInput.value) * 1000 || 10 * 1000;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;localTurnStartTime = Date.now();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;stopTimer();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerXReady = false;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerOReady = false;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerXRematch = false;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerORematch = false;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;preMoveIndexToHighlight = -1;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;newGameBtn.style.display = &#39;none&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;readyBtn.style.display = &#39;none&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rematchBtn.style.display = &#39;none&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;updateTimerDisplay();<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!isOfflineMode &amp;&amp; gameId) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gameActive = false; // For online, explicitly set to false until ready_check becomes playing<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (isHost) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;try {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await deleteDoc(doc(db, `artifacts/${MY_APP_ID}/public/data/games`, gameId));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayMessage(`Game &#39;${gameId}&#39; has been reset/deleted by host. Create or join a new game.`, &quot;text-blue-600&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; catch (error) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.error(&quot;Error deleting game document:&quot;, error);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayModal(&quot;Error&quot;, &quot;Failed to reset game on server. Please try refreshing.&quot;, false);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayMessage(&quot;Game reset. You can create a new game or join another.&quot;, &quot;text-blue-600&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gameId = null;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerSymbol = null;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;opponentSymbol = null;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;isHost = false;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (unsubscribeGameListener) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;unsubscribeGameListener();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;unsubscribeGameListener = null;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else if (isOfflineMode) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gameActive = true; // For offline, set to true immediately for playability<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayMessage(&quot;Offline game started. You are X!&quot;, &quot;text-gray-700&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerSymbol = &quot;X&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;opponentSymbol = &quot;O&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;startTimer(localPlayerXTimeLeft, localPlayerOTimeLeft, localTurnStartTime, currentPlayer);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gameActive = false; // No game active (default initial state)<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayMessage(&quot;Welcome! Create or join an online game, or Play Offline.&quot;, &quot;text-gray-700&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;renderBoard(); // Call renderBoard AFTER gameActive is correctly set for both modes<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const getScoreboardRef = (userId) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return doc(db, `artifacts/${MY_APP_ID}/users/${userId}/scoreboard`, &quot;scores&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const loadScoreboard = async (userId) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!userId) return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const scoreboardRef = getScoreboardRef(userId);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;try {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const docSnap = await getDoc(scoreboardRef);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (docSnap.exists()) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const data = docSnap.data();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerXScore = data.xWins || 0;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerOScore = data.oWins || 0;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;drawScore = data.draws || 0;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await setDoc(scoreboardRef, { xWins: 0, oWins: 0, draws: 0 });<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerXScore = 0;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerOScore = 0;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;drawScore = 0;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;updateScoreboardUI();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} catch (error) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.error(&quot;Error loading scoreboard:&quot;, error);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayModal(&quot;Error&quot;, &quot;Failed to load scoreboard.&quot;, false);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const updateScoreboard = async (userId, xWinIncrement, oWinIncrement, drawIncrement) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!userId) return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const scoreboardRef = getScoreboardRef(userId);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;try {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const docSnap = await getDoc(scoreboardRef);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let currentXWins = 0;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let currentOWins = 0;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let currentDraws = 0;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (docSnap.exists()) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const data = docSnap.data();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentXWins = data.xWins || 0;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentOWins = data.oWins || 0;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentDraws = data.draws || 0;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await updateDoc(scoreboardRef, {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;xWins: currentXWins + xWinIncrement,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;oWins: currentOWins + oWinIncrement,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;draws: currentDraws + drawIncrement<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerXScore = currentXWins + xWinIncrement;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playerOScore = currentOWins + oWinIncrement;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;drawScore = currentDraws + drawIncrement;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;updateScoreboardUI();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} catch (error) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.error(&quot;Error updating scoreboard:&quot;, error);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayModal(&quot;Error&quot;, &quot;Failed to update scoreboard.&quot;, false);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const listenToLobbyChanges = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const gamesCollectionRef = collection(db, `artifacts/${MY_APP_ID}/public/data/games`);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;onSnapshot(gamesCollectionRef, (snapshot) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (isOfflineMode) return;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gameList.innerHTML = &quot;&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let hasActiveGames = false;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;snapshot.forEach(async (doc) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const data = doc.data();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const gameRoomId = doc.id;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const listItem = document.createElement(&quot;li&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;listItem.classList.add(&quot;py-2&quot;, &quot;border-b&quot;, &quot;border-gray-200&quot;, &quot;flex&quot;, &quot;justify-between&quot;, &quot;items-center&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let statusText = &quot;&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let joinBtnHtml = &quot;&quot;;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (data.status === &quot;waiting&quot; &amp;&amp; data.playerOId === null &amp;&amp; (Date.now() - data.createdAt &gt; STALE_ROOM_TIMEOUT_MS)) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.log(`Deleting stale waiting room: ${gameRoomId}`);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;try {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await deleteDoc(doc(db, `artifacts/${MY_APP_ID}/public/data/games`, gameRoomId));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} catch (error) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.error(`Error deleting stale room ${gameRoomId}:`, error);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;statusText = `&lt;span class=&quot;text-red-500&quot;&gt;Stale/Error deleting&lt;/span&gt;`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;joinBtnHtml = `&lt;span class=&quot;text-xs text-gray-500&quot;&gt;Stuck&lt;/span&gt;`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (statusText === &quot;&quot;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (data.status === &quot;waiting&quot;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;statusText = `Waiting for player (X: ${data.playerXId.substring(0,6)}...)`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;joinBtnHtml = `&lt;button class=&quot;button secondary text-sm px-3 py-1 ml-2&quot; onclick=&quot;document.getElementById(&#39;gameIdInput&#39;).value=&#39;${gameRoomId}&#39;; document.getElementById(&#39;joinGameBtn&#39;).click();&quot;&gt;Join&lt;/button&gt;`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;hasActiveGames = true;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else if (data.status === &quot;ready_check&quot;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let readyStatus = &#39;&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (data.playerXReady) readyStatus += &#39;X Ready &#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (data.playerOReady) readyStatus += &#39;O Ready&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let rematchStatus = &#39;&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (data.playerXRematch) rematchStatus += &#39;X Rematch &#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (data.playerORematch) rematchStatus += &#39;O Rematch&#39;;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;statusText = `Players Ready: ${readyStatus.trim() || &#39;None&#39;}`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (rematchStatus) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;statusText += ` | Rematch: ${rematchStatus.trim()}`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;joinBtnHtml = `&lt;span class=&quot;text-xs text-gray-500&quot;&gt;In Prep&lt;/span&gt;`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;hasActiveGames = true;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else if (data.status === &quot;playing&quot;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;statusText = `In Progress (X: ${data.playerXId.substring(0,6)}... O: ${data.playerOId ? data.playerOId.substring(0,6) + &#39;...&#39; : &#39;?&#39;})`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;joinBtnHtml = `&lt;span class=&quot;text-xs text-gray-500&quot;&gt;Full&lt;/span&gt;`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;hasActiveGames = true;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else if (data.status.includes(&quot;_wins&quot;) || data.status === &quot;draw&quot; || data.status.includes(&quot;_timeout&quot;)) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;statusText = `Game Over (${data.status.replace(&#39;_&#39;, &#39; &#39;).replace(&#39;s&#39;, &#39;&#39;)})`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;joinBtnHtml = `&lt;span class=&quot;text-xs text-gray-500&quot;&gt;Ended&lt;/span&gt;`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;hasActiveGames = true;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (statusText !== &quot;&quot;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;listItem.innerHTML = `<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span class=&quot;font-medium&quot;&gt;ID: ${gameRoomId}&lt;/span&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;flex items-center&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span class=&quot;text-sm text-gray-600 mr-2&quot;&gt;${statusText}&lt;/span&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;${joinBtnHtml}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gameList.appendChild(listItem);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!hasActiveGames &amp;&amp; snapshot.empty) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gameList.innerHTML = &quot;&lt;li class=&#39;text-gray-500&#39;&gt;No active games. Create one!&lt;/li&gt;&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}, (error) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.error(&quot;Error listening to lobby changes:&quot;, error);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayModal(&quot;Error&quot;, &quot;Failed to load game lobby. Please refresh.&quot;, false);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const showOnlineControls = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;onlineControlsDiv.style.display = &#39;flex&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playOfflineBtn.style.display = &#39;block&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;goOnlineBtn.style.display = &#39;none&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gameList.parentElement.style.display = &#39;block&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;isOfflineMode = false;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;resetGame();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayMessage(&quot;Create or join an online game.&quot;, &quot;text-gray-700&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const showOfflineControls = (startGameImmediately = true) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;onlineControlsDiv.style.display = &#39;none&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playOfflineBtn.style.display = &#39;none&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;goOnlineBtn.style.display = &#39;block&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gameList.parentElement.style.display = &#39;none&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;isOfflineMode = true;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (startGameImmediately) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;resetGame();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;board = [&quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gameActive = false;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;winner = null;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;stopTimer();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;renderBoard();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;newGameBtn.style.display = &#39;none&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;readyBtn.style.display = &#39;none&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rematchBtn.style.display = &#39;none&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;localPlayerXTimeLeft = parseInt(gameTimerInput.value) * 1000 || 10 * 1000;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;localPlayerOTimeLeft = parseInt(gameTimerInput.value) * 1000 || 10 * 1000;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;updateTimerDisplay();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br><br> &nbsp; &nbsp; &nbsp; &nbsp;// --- Event Listeners ---<br> &nbsp; &nbsp; &nbsp; &nbsp;newGameBtn.addEventListener(&quot;click&quot;, resetGame);<br> &nbsp; &nbsp; &nbsp; &nbsp;createGameBtn.addEventListener(&quot;click&quot;, createGame);<br> &nbsp; &nbsp; &nbsp; &nbsp;joinGameBtn.addEventListener(&quot;click&quot;, joinGame);<br> &nbsp; &nbsp; &nbsp; &nbsp;readyBtn.addEventListener(&quot;click&quot;, handleReadyClick);<br> &nbsp; &nbsp; &nbsp; &nbsp;rematchBtn.addEventListener(&quot;click&quot;, handleRematchClick);<br> &nbsp; &nbsp; &nbsp; &nbsp;resetScoreboardBtn.addEventListener(&quot;click&quot;, resetScoreboard);<br> &nbsp; &nbsp; &nbsp; &nbsp;playOfflineBtn.addEventListener(&quot;click&quot;, () =&gt; showOfflineControls(true));<br> &nbsp; &nbsp; &nbsp; &nbsp;goOnlineBtn.addEventListener(&quot;click&quot;, showOnlineControls);<br><br> &nbsp; &nbsp; &nbsp; &nbsp;modalCloseBtn.addEventListener(&quot;click&quot;, hideModal);<br> &nbsp; &nbsp; &nbsp; &nbsp;modalConfirmBtn.addEventListener(&quot;click&quot;, () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (modalConfirmCallback) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;modalConfirmCallback();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;hideModal();<br> &nbsp; &nbsp; &nbsp; &nbsp;});<br><br><br> &nbsp; &nbsp; &nbsp; &nbsp;// Initial setup<br> &nbsp; &nbsp; &nbsp; &nbsp;window.onload = initFirebase;<br> &nbsp; &nbsp;&lt;/script&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></span></p></body></html>